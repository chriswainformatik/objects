CodeMirror.defineSimpleMode("objectslang",{start:[{regex:/[a-zA-Z][a-zA-Z0-9]*/,token:"identifier",next:"seperator"}],seperator:[{regex:/:/,token:"seperator",next:"instancecreation"},{regex:/./,token:"seperator",next:"methodcall"}],instancecreation:[{regex:/[A-Z]*/,token:"classname",next:"start"}],methodcall:[{regex:/[a-zäöüA-ZÄÖÜ][a-zäöüßA-ZÄÖÜ0-9]*/,token:"methodcall",next:"paranthesis"}],paranthesis:[{regex:/\(/,next:"param"},{regex:/\)/,next:"start"}],param:[{regex:/[0-9]+/,token:"number",next:"paramseperator"},{regex:/("[a-zäöüA-ZÄÖÜ][a-zäöüßA-ZÄÖÜ0-9]*"|[a-zäöü?A-ZÄÖÜ][a-zäöüßA-ZÄÖÜ0-9]*)/,token:"string",next:"paramseperator"}],paramseperator:[{regex:/,/,next:"param"},{regex:/\)/,next:"start"}]});var editor=CodeMirror.fromTextArea(myTextarea,{lineNumbers:!0,mode:"objectslang"}),runner=(document.getElementsByClassName("CodeMirror")[0].classList.add("border"),void 0),popovers=[];function toggleAutocompletion(e){e?editor.addKeyMap({"Ctrl-Space":"autocomplete"}):editor.removeKeyMap("Ctrl-Space")}function runCode(){Array.from(document.getElementById("the-canvas").childNodes).forEach(e=>{e.classList.contains("graphical-object")&&e.remove()}),runner.clearObjects(),popovers.forEach(e=>{try{e.dispose()}catch(e){console.log(e)}}),popovers=[],clearLineBackgrounds(),runner.setLines(editor.getValue().split("\n")),runner.runCode(setSyntaxError,setSemanticError,setActiveLine,updateDOMObject)}function updateDOMObject(e){function t(e,t,n,r="solid"){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var a=1;a<t.length;a++)e.lineTo(t[a][0],t[a][1]);e.closePath(),"fill"==n?e.fill():"stroke"==n&&(e.setLineDash(o(r)),e.stroke())}function o(e){return"solid"==e?[]:"dashed"==e?[2*a.lineWidth,2*a.lineWidth]:"dotted"==e?[.5*a.lineWidth,a.lineWidth]:void 0}var n,r=document.getElementById(e.instanceName),a=(r.style.top=e.y-e.h+"px",r.style.left=e.x+"px",r.width=e.w,r.height=e.h,r.getContext("2d"));a.clearRect(0,0,r.width,r.height),a.fillStyle=e.fillColor,a.strokeStyle=e.lineColor,a.lineWidth=e.lineWidth,a.lineJoin="milter","triangle"==e.type?(n=[[0,e.h],[e.w,e.h],[e.w/2,0],[0,e.h]],t(a,n,"fill"),a.globalCompositeOperation="source-over",t(a,n,"stroke",e.lineStyle),a.globalCompositeOperation="destination-in",t(a,n,"fill")):"circle"==e.type?(r.style.top=e.y-e.w/2+"px",r.style.left=e.x-e.w/2+"px",a.beginPath(),a.arc(e.w/2,e.h/2,e.w/2,0,2*Math.PI,!1),a.fill(),a.lineWidth=a.lineWidth/2,a.beginPath(),a.arc(e.w/2,e.h/2,e.w/2-a.lineWidth/2,0,2*Math.PI,!1),a.setLineDash(o(e.lineStyle)),a.stroke()):"rectangle"==e.type&&(console.log(e),a.fillRect(0,0,e.w,e.h),a.setLineDash(o(e.lineStyle)),a.strokeRect(0,0,e.w,e.h)),updateObjectCards(e)}function updateObjectCards(e){for(var t,n,r=document.getElementById("object-card-"+e.instanceName),a=(null==r&&(t=document.getElementById("object-cards-wrapper"),(n=document.createElement("div")).id="object-card-"+e.instanceName,n.classList.add("object-card"),n.classList.add("d-flex"),n.classList.add("flex-column"),(o=document.createElement("div")).classList.add("object-card-header"),o.innerHTML=e.instanceName+" : "+e.constructor.name,n.append(o),t.append(n)),r=document.getElementById("object-card-"+e.instanceName),e),o=r.firstChild,l=(r.innerHTML="",r.append(o),function(e){for(var t=0;t<globalClassesList.length;t++)if(globalClassesList[t].name==e)return globalClassesList[t].attributes;return null}(a.constructor.name)),i=0;i<l.length;i++){var s=l[i];if(0<s.name.length){var c=document.createElement("div"),d="",m=("string"==s.type&&(d='"'),a[s.name2]);if("KREIS"==a.constructor.name&&"radius"==s.name&&(m=a.w),s.name.includes("farbe"))for(var p in globalColorNames)globalColorNames[p]==m&&(m=p);else if(s.name.includes("art"))for(var p in globalLineStyleNames)globalLineStyleNames[p]==m&&(m=p);c.innerHTML=s.name+" = "+d+m+d,r.append(c)}}}function clearLineBackgrounds(){for(var e=0;e<editor.lineCount();e++)editor.removeLineClass(e,"background")}function setActiveLine(e){clearLineBackgrounds(),0<=e&&editor.addLineClass(e,"background","active-line")}function setSyntaxError(e){editor.addLineClass(e,"background","error-line"),console.log("Syntax error");var t=new bootstrap.Popover(document.getElementsByClassName("error-line")[0],{html:!0,content:'<p>Fehler in dieser Zeile!<br>Hast du dich vertippt?</p><div class="text-center"><small><i>Anklicken zum Schließen</i></small></div>',placement:"bottom"});t.show(),popovers.push(t),document.getElementsByClassName("popover")[0].addEventListener("click",()=>{t.dispose()})}function setSemanticError(e,t){editor.addLineClass(e,"background","error-line"),console.log("Semantics error");var n=new bootstrap.Popover(document.getElementsByClassName("error-line")[0],{html:!0,content:"<p>"+t.germanText+'<br>Hast du dich vertippt?</p><div class="text-center"><small><i>Anklicken zum Schließen</i></small></div>',placement:"bottom"});n.show(),popovers.push(n),document.getElementsByClassName("popover")[0].addEventListener("click",()=>{n.dispose()})}document.addEventListener("DOMContentLoaded",function(){runner=new CodeRunner(globalClassesList),document.getElementById("btn-run-code").addEventListener("click",runCode);[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)});document.getElementById("velocity").addEventListener("change",function(e){runner.setStepDelay(2-e.target.value)}),document.getElementById("check-enable-autocomplete").addEventListener("change",e=>toggleAutocompletion(e.target.checked))},!1);